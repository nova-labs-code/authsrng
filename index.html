<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
  <meta content="IE=Edge" http-equiv="X-UA-Compatible"/>
  <title>
   auth's RNG
  </title>
  <meta content="a simple web based RNG game!" name="description"/>
  <meta content="website" property="og:type"/>
  <meta content="auth's RNG" property="og:site_name"/>
  <meta content="auth's RNG" property="og:title"/>
  <meta content="a simple web based RNG game!" property="og:description"/>
  <meta content="https://i.imgur.com/RZVHfEq.png" property="og:image"/>
  <meta content="https://authsrng.neocities.org/" property="og:url"/>
  <meta content="summary_large_image" name="twitter:card"/>
  <meta content="auth's RNG" name="twitter:title"/>
  <meta content="a simple web based RNG game!" name="twitter:description"/>
  <meta content="https://i.imgur.com/RZVHfEq.png" name="twitter:image"/>
  <meta content="https://authsrng.neocities.org/" name="twitter:url"/>
  <meta content="yes" name="mobile-web-app-capable"/>
  <meta content="auth's RNG" name="application-name"/>
  <meta content="#0e0e0e" name="theme-color"/>
  <meta content="yes" name="apple-mobile-web-app-capable"/>
  <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
  <link href="https://i.imgur.com/RZVHfEq.png" rel="icon" sizes="192x192"/>
  <link href="manifest.json" rel="manifest"/>
  <link href="https://i.imgur.com" rel="preconnect"/>
  <link href="https://i.imgur.com" rel="dns-prefetch"/>
  <meta content="Hk9UjE10tHajAW3IhKIPdlKD22Bc9muZxMepbS595sA" name="google-site-verification"/>
  <meta content="camera=(), microphone=(), geolocation=(), payment=()" http-equiv="Permissions-Policy"/>
  <meta content="telephone=no, email=no, address=no" name="format-detection"/>
  <meta content="notranslate" name="google"/>
  <script type="application/ld+json">
   {
    "@context": "https://schema.org",
    "@type": "VideoGame",
    "name": "auth's RNG",
    "description": "a simple web based RNG game!",
    "image": "https://i.imgur.com/RZVHfEq.png",
    "url": "https://authsrng.neocities.org/",
    "applicationCategory": "Game",
    "operatingSystem": "All",
    "author": {
      "@type": "Person",
      "name": "auth",
      "url": "https://authguy.nekoweb.org"
    }
  }
  </script>
  <script src="js/legacy-polyfills.js">
  </script>
  <!--[if lt IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
  <![endif]-->
  <!-- IF YOU REMOVE ANY OF THESE META TAGS, I WILL KILL YOU!!!!! -->
  <!-- DOING SO RUINS SOME FEATURES AND RUINS COMPATIBILITY!!!!!!!!!!! -->
  <!-- DONT EVER DO IT!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
  <link href="css/styles.css" rel="stylesheet"/>
  <script src="js/legacy-polyfills.js">
  </script>
  <script src="js/legacy-polyfills.js">
  </script>
  <script src="js/legacy-polyfills.js">
  </script>
  <style>
   .entry-container {
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: #0e0e0e;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      opacity: 1;
      transition: opacity 1.2s ease;
    }

    .tap-text {
      position: absolute;
      bottom: 8%;
      color: #dcdcdc;
      font-size: 0.9em;
      font-family: monospace;
      letter-spacing: 0.08em;
      opacity: 0;
      animation: fadein 1.5s ease forwards 0.8s, pulse 2s ease-in-out infinite 2.5s;
      user-select: none;
      text-transform: lowercase;
    }

    @keyframes fadein {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 0.6; transform: translateY(0); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 0.25; }
    }

    .center-line {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 1px;
      height: 1px;
      background: #dcdcdc;
      transform: translate(-50%, -50%);
      opacity: 0.8;
      transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .expand-horizontal {
      width: 100%;
      height: 1px;
    }

    .expand-vertical {
      width: 100%;
      height: 100%;
    }

    .fade-line {
      animation: fade-line 0.6s ease forwards;
    }

    @keyframes fade-line {
      from { opacity: 0.8; }
      to { opacity: 0; }
    }
  </style>
 </head>
 <body style="font-size: 16px; font-family: monospace;">
  <script src="js/startanim.js">
  </script>
  <script src="js/screensaver.js">
  </script>
  <div style="position: fixed; inset: 0px; display: flex; align-items: center; justify-content: center; background: rgb(14, 14, 14); z-index: 9999; opacity: 0; transition: opacity 1.5s; pointer-events: none;">
   <div style="font-family: monospace; font-size: 1.4rem; color: rgb(220, 220, 220); text-align: center; padding: 2rem; max-width: 80vw; opacity: 0.85; letter-spacing: 0.05em; line-height: 1.6;">
   </div>
  </div>
  <button id="legacyShopBtn">
   shop
  </button>
  <button id="legacySettingsBtn">
   settings
  </button>
  <div id="legacyShopPopup">
  </div>
  <div id="legacySettingsPopup">
  </div>
  <!-- if you're reading this in the source code, you're cool -->
  <!-- yes i recoded everything i hate myself -->
  <!-- BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~  BITES AT YOU~ -->
  <h2 class="lazy" data-observed="true">
   welcome to auth's RNG!
  </h2>
  <p class="lazy" data-observed="true">
   psst user, yeah you, this is version 9.1 pre-release, don't expect really epic things right now its in
    progress
  </p>
  <a class="lazy" data-observed="true" href="html/countdown.html">
   UPDATE 9.1 COUNTDOWN!!!
  </a>
  <a class="lazy" data-observed="true" href="html/blog.html">
   blog
  </a>
  <div class="page-wrapper">
   <div class="page-container" style="transform: translateX(0%); height: 1140px;">
    <div class="page" id="page-1">
     <button class="lazy" data-observed="true" id="rollBtn">
      roll
     </button>
     <div class="lazy" data-observed="true" id="spinnerContainer">
      <div id="spinner">
      </div>
     </div>
     <p class="lazy visible" data-observed="true" id="totalRolls">
      total rolls: 0
     </p>
     <div class="lazy visible" data-observed="true" id="luckDisplay">
      <p id="luckMultiplier">
       luck multiplier: 1.0x
      </p>
      <p class="small" id="luckBreakdown">
       base luck (no modifiers active)
      </p>
     </div>
     <div class="lazy visible" data-observed="true" id="dailyContainer">
      <div id="dailyStatus">
       daily available Â· current streak: 0
      </div>
      <button id="dailyBtn">
       claim daily
      </button>
     </div>
     <div class="lazy visible" data-observed="true" id="weeklyContainer">
      <div id="weeklyStatus">
       weekly reward available Â· streak: 0
      </div>
      <button id="weeklyBtn">
       claim weekly
      </button>
     </div>
     <br class="lazy visible" data-observed="true"/>
     <div class="lazy visible" data-observed="true" id="inventorySection">
      <div class="inventory-header">
       <span class="inventory-title">
        .................
       </span>
       <div class="inventory-controls">
        <span class="sort-label">
         sort
        </span>
        <select id="sortSelect">
         <option value="rare">
          rarest â common
         </option>
         <option value="common">
          common â rarest
         </option>
         <option value="alpha">
          a â z
         </option>
        </select>
       </div>
      </div>
      <div id="inventoryContainer">
       <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5em;">
        <div id="collectedCounter">
         0/563 collected
        </div>
        <button class="small" id="indexBtn">
         view index
        </button>
       </div>
       <ul id="inventoryList">
       </ul>
      </div>
      <div id="anomalyPanel" title="anomalies are rare, consume for permanent luck boosts">
       <span id="anomalyCount">
        Anomalies: 0
       </span>
       <div style="display: flex; gap: 4px;">
        <button class="small" disabled="" id="consumeAnomalyBtn">
         consume one
        </button>
        <button class="small" disabled="" id="consumeAllAnomaliesBtn">
         consume all
        </button>
       </div>
      </div>
     </div>
     <div class="lazy visible" data-observed="true" id="achievementsContainer">
      <div class="achievement">
       <div class="achievement-name">
        Roller
       </div>
       <div class="achievement-subtitle">
        Get 100 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Gambler
       </div>
       <div class="achievement-subtitle">
        Get 200 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Discord Mod
       </div>
       <div class="achievement-subtitle">
        Get 300 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Touch Grass Please
       </div>
       <div class="achievement-subtitle">
        Get 400 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Addicted
       </div>
       <div class="achievement-subtitle">
        Get 500 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Insane
       </div>
       <div class="achievement-subtitle">
        Get 600 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Joel
       </div>
       <div class="achievement-subtitle">
        Get 700 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Crazy Addicted
       </div>
       <div class="achievement-subtitle">
        Get 800 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Funky Town
       </div>
       <div class="achievement-subtitle">
        Get 900 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        It's Outside Time Now
       </div>
       <div class="achievement-subtitle">
        Get 1000 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Actually Addicted
       </div>
       <div class="achievement-subtitle">
        Get 5000 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        ..what
       </div>
       <div class="achievement-subtitle">
        Get 7000 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Devoted
       </div>
       <div class="achievement-subtitle">
        Get 10000 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        get a job
       </div>
       <div class="achievement-subtitle">
        Get 15000 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Genuinely Insane
       </div>
       <div class="achievement-subtitle">
        Get 25000 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Roll Factory
       </div>
       <div class="achievement-subtitle">
        Get 30000 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Just One More Roll
       </div>
       <div class="achievement-subtitle">
        Get 50000 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Got No LIfe
       </div>
       <div class="achievement-subtitle">
        Get 70000 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Introverted
       </div>
       <div class="achievement-subtitle">
        Get 150000 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        HOLY HELL
       </div>
       <div class="achievement-subtitle">
        Get 500000 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        dude
       </div>
       <div class="achievement-subtitle">
        Get 1000000 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        PLEASE JUST STOP
       </div>
       <div class="achievement-subtitle">
        Get 5000000 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        you will pay
       </div>
       <div class="achievement-subtitle">
        Get 10000000 Rolls
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Starting Out
       </div>
       <div class="achievement-subtitle">
        Get A Rarity Under 1/70
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Lucky
       </div>
       <div class="achievement-subtitle">
        Get A Rarity Above 1/70
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Spammin
       </div>
       <div class="achievement-subtitle">
        Get A Rarity Above 1/300
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Left Handed
       </div>
       <div class="achievement-subtitle">
        Get A Rarity Above 1/600
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Insanely Lucky
       </div>
       <div class="achievement-subtitle">
        Get A Rarity Above 1/800
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Lunar
       </div>
       <div class="achievement-subtitle">
        Get Lunar
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Jackpot
       </div>
       <div class="achievement-subtitle">
        Get A Rarity Above 5000
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Antimatter
       </div>
       <div class="achievement-subtitle">
        Get A Rarity Above 15000
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        oh my god
       </div>
       <div class="achievement-subtitle">
        Get A Rarity Above 50000
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Market Crash
       </div>
       <div class="achievement-subtitle">
        Get A Rarity Above 100000
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        Phenomenon
       </div>
       <div class="achievement-subtitle">
        Get A Rarity Above 10000000
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        ok bro
       </div>
       <div class="achievement-subtitle">
        Get A Rarity Above 1000000000
       </div>
      </div>
      <div class="achievement">
       <div class="achievement-name">
        SUMMER
       </div>
       <div class="achievement-subtitle">
        Get SUMMER
       </div>
      </div>
     </div>
    </div>
    <div class="page" id="page-2">
     <h2 style="margin-top: 0;">
      shop
     </h2>
     <div id="pointsDisplay">
      points:
      <span id="pointsValue">
       0
      </span>
     </div>
     <div class="shop-item">
      <div class="shop-item-header">
       <div class="shop-item-name">
        luck boost
       </div>
       <div class="shop-item-level">
        level:
        <span id="luckLevel">
         0
        </span>
        /100
       </div>
      </div>
      <div class="shop-item-desc">
       get 1.1x more luck on chances (multiplicative)
      </div>
      <div class="shop-item-footer">
       <div class="shop-item-cost">
        cost:
        <span id="luckCost">
         50
        </span>
        points
       </div>
       <button class="small" disabled="" id="buyLuckBtn">
        buy luck upgrade (25 pts)
       </button>
      </div>
     </div>
     <div class="shop-item">
      <div class="shop-item-header">
       <div class="shop-item-name">
        roll speed
       </div>
       <div class="shop-item-level">
        level:
        <span id="speedLevel">
         0
        </span>
        /3
       </div>
      </div>
      <div class="shop-item-desc">
       decrease roll time by 0.2s (min 0.25s)
      </div>
      <div class="shop-item-footer">
       <div class="shop-item-cost">
        cost:
        <span id="speedCost">
         100
        </span>
        points
       </div>
       <button class="small" disabled="" id="buySpeedBtn">
        buy speed upgrade (50 pts)
       </button>
      </div>
     </div>
     <div class="shop-item">
      <div class="shop-item-header">
       <div class="shop-item-name">
        point multiplier
       </div>
       <div class="shop-item-level">
        level:
        <span id="pointLevel">
         0
        </span>
        /10
       </div>
      </div>
      <div class="shop-item-desc">
       decrease point divisor by 0.2 (more points per sell)
      </div>
      <div class="shop-item-footer">
       <div class="shop-item-cost">
        cost:
        <span id="pointCost">
         150
        </span>
        points
       </div>
       <button class="small" disabled="" id="buyPointBtn">
        buy points upgrade (100 pts)
       </button>
      </div>
     </div>
     <div class="shop-item">
      <div class="shop-item-header">
       <div class="shop-item-name">
        rarity magnet
       </div>
       <div class="shop-item-level">
        level:
        <span id="magnetLevel">
         0
        </span>
        /5
       </div>
      </div>
      <div class="shop-item-desc">
       1.1x boost to uncollected rarities per level
      </div>
      <div class="shop-item-footer">
       <div class="shop-item-cost">
        cost:
        <span id="magnetCost">
         500
        </span>
        points
       </div>
       <button class="small" disabled="" id="buyMagnetBtn">
        upgrade (500 pts)
       </button>
      </div>
     </div>
     <div class="shop-item">
      <div class="shop-item-header">
       <div class="shop-item-name">
        point printer
       </div>
       <div class="shop-item-level">
        level:
        <span id="printerLevel">
         0
        </span>
       </div>
      </div>
      <div class="shop-item-desc">
       passive points generation (1pt/sec per level)
      </div>
      <div class="shop-item-footer">
       <div class="shop-item-cost">
        cost:
        <span id="printerCost">
         1000
        </span>
        points
       </div>
       <button class="small" disabled="" id="buyPrinterBtn">
        upgrade (1000 pts)
       </button>
      </div>
     </div>
     <div class="shop-item">
      <div class="shop-item-header">
       <div class="shop-item-name">
        duplicate chance
       </div>
       <div class="shop-item-level">
        level:
        <span id="dupeLevel">
         0
        </span>
        /10
       </div>
      </div>
      <div class="shop-item-desc">
       1% chance per level to get +1 extra rarity on roll
      </div>
      <div class="shop-item-footer">
       <div class="shop-item-cost">
        cost:
        <span id="dupeCost">
         800
        </span>
        points
       </div>
       <button class="small" disabled="" id="buyDupeBtn">
        upgrade (800 pts)
       </button>
      </div>
     </div>
     <!-- POTIONS SECTION -->
     <div class="potion-section">
      <div class="potion-section-title">
       ð§ª potions
      </div>
      <div class="potion-grid">
       <!-- 2x Luck -->
       <div class="potion-item" data-potion="luck2x">
        <div class="potion-emoji">
         â¨
        </div>
        <div class="potion-name">
         2x luck
        </div>
        <div class="potion-effect">
         30 seconds
        </div>
        <div class="potion-cost">
         2,000 pts
        </div>
        <div class="potion-owned">
         owned:
         <span id="potion-luck2x-count">
          0
         </span>
        </div>
        <button class="small" onclick="buyPotion('luck2x')">
         buy
        </button>
        <button class="small" onclick="usePotion('luck2x')" style="margin-top: 4px;">
         use
        </button>
       </div>
       <!-- 4x Luck -->
       <div class="potion-item" data-potion="luck4x">
        <div class="potion-emoji">
         ð«
        </div>
        <div class="potion-name">
         4x luck
        </div>
        <div class="potion-effect">
         30 seconds
        </div>
        <div class="potion-cost">
         5,000 pts
        </div>
        <div class="potion-owned">
         owned:
         <span id="potion-luck4x-count">
          0
         </span>
        </div>
        <button class="small" onclick="buyPotion('luck4x')">
         buy
        </button>
        <button class="small" onclick="usePotion('luck4x')" style="margin-top: 4px;">
         use
        </button>
       </div>
       <!-- 10x Luck -->
       <div class="potion-item" data-potion="luck10x">
        <div class="potion-emoji">
         ð
        </div>
        <div class="potion-name">
         10x luck
        </div>
        <div class="potion-effect">
         30 seconds
        </div>
        <div class="potion-cost">
         15,000 pts
        </div>
        <div class="potion-owned">
         owned:
         <span id="potion-luck10x-count">
          0
         </span>
        </div>
        <button class="small" onclick="buyPotion('luck10x')">
         buy
        </button>
        <button class="small" onclick="usePotion('luck10x')" style="margin-top: 4px;">
         use
        </button>
       </div>
       <!-- 50x Luck -->
       <div class="potion-item" data-potion="luck50x">
        <div class="potion-emoji">
         â­
        </div>
        <div class="potion-name">
         50x luck
        </div>
        <div class="potion-effect">
         30 seconds
        </div>
        <div class="potion-cost">
         30,000 pts
        </div>
        <div class="potion-owned">
         owned:
         <span id="potion-luck50x-count">
          0
         </span>
        </div>
        <button class="small" onclick="buyPotion('luck50x')">
         buy
        </button>
        <button class="small" onclick="usePotion('luck50x')" style="margin-top: 4px;">
         use
        </button>
       </div>
       <!-- 100x Luck -->
       <div class="potion-item" data-potion="luck100x">
        <div class="potion-emoji">
         ð¥
        </div>
        <div class="potion-name">
         100x luck
        </div>
        <div class="potion-effect">
         30 seconds
        </div>
        <div class="potion-cost">
         45,000 pts
        </div>
        <div class="potion-owned">
         owned:
         <span id="potion-luck100x-count">
          0
         </span>
        </div>
        <button class="small" onclick="buyPotion('luck100x')">
         buy
        </button>
        <button class="small" onclick="usePotion('luck100x')" style="margin-top: 4px;">
         use
        </button>
       </div>
       <!-- 150x Luck -->
       <div class="potion-item" data-potion="luck150x">
        <div class="potion-emoji">
         ð¥
        </div>
        <div class="potion-name">
         150x luck
        </div>
        <div class="potion-effect">
         30 seconds
        </div>
        <div class="potion-cost">
         60,000 pts
        </div>
        <div class="potion-owned">
         owned:
         <span id="potion-luck150x-count">
          0
         </span>
        </div>
        <button class="small" onclick="buyPotion('luck150x')">
         buy
        </button>
        <button class="small" onclick="usePotion('luck150x')" style="margin-top: 4px;">
         use
        </button>
       </div>
       <!-- 250x Luck -->
       <div class="potion-item" data-potion="luck250x">
        <div class="potion-emoji">
         â¡
        </div>
        <div class="potion-name">
         250x luck
        </div>
        <div class="potion-effect">
         30 seconds
        </div>
        <div class="potion-cost">
         80,000 pts
        </div>
        <div class="potion-owned">
         owned:
         <span id="potion-luck250x-count">
          0
         </span>
        </div>
        <button class="small" onclick="buyPotion('luck250x')">
         buy
        </button>
        <button class="small" onclick="usePotion('luck250x')" style="margin-top: 4px;">
         use
        </button>
       </div>
       <!-- 300x Luck (OMEGA) -->
       <div class="potion-item" data-potion="luck300x">
        <div class="potion-emoji">
         ð
        </div>
        <div class="potion-name">
         OMEGA LUCK
        </div>
        <div class="potion-effect">
         30 seconds
        </div>
        <div class="potion-cost">
         150,000 pts
        </div>
        <div class="potion-owned">
         owned:
         <span id="potion-luck300x-count">
          0
         </span>
        </div>
        <button class="small" onclick="buyPotion('luck300x')">
         buy
        </button>
        <button class="small" onclick="usePotion('luck300x')" style="margin-top: 4px;">
         use
        </button>
       </div>
       <!-- Duplicate Potion -->
       <div class="potion-item" data-potion="duplicate">
        <div class="potion-emoji">
         ð­
        </div>
        <div class="potion-name">
         duplicate
        </div>
        <div class="potion-effect">
         next 10 rolls x2
        </div>
        <div class="potion-cost">
         5,000 pts
        </div>
        <div class="potion-owned">
         owned:
         <span id="potion-duplicate-count">
          0
         </span>
        </div>
        <button class="small" onclick="buyPotion('duplicate')">
         buy
        </button>
        <button class="small" onclick="usePotion('duplicate')" style="margin-top: 4px;">
         use
        </button>
       </div>
      </div>
     </div>
     <div id="confirmModal">
      <div class="modal-content">
       <h3 id="modalTitle">
       </h3>
       <p id="modalText">
       </p>
       <div class="modal-buttons">
        <button id="modalConfirm">
         confirm
        </button>
        <button id="modalCancel">
         cancel
        </button>
       </div>
      </div>
     </div>
    </div>
    <div class="page" id="page-3">
     <h2 style="margin-top: 0;">
      wishing well
     </h2>
     <div class="well-container">
      <div class="well-title">
       ancient wishing well
      </div>
      <div class="well-subtitle">
       throw points in and make a wish...
      </div>
      <div class="well-visual" id="wellVisual">
       ð
      </div>
      <div class="well-input-container">
       <input class="well-input" id="wellInput" min="1" placeholder="enter points..." type="number"/>
       <div class="well-quick-btns">
        <button class="well-quick-btn small" onclick="setWellAmount(10)">
         10
        </button>
        <button class="well-quick-btn small" onclick="setWellAmount(50)">
         50
        </button>
        <button class="well-quick-btn small" onclick="setWellAmount(100)">
         100
        </button>
        <button class="well-quick-btn small" onclick="setWellAmount(500)">
         500
        </button>
       </div>
       <button class="well-throw-btn" id="throwWellBtn">
        throw points in
       </button>
      </div>
      <div class="well-status" id="wellStatus">
       ready to accept your offering
      </div>
      <div class="well-timer" id="wellTimer">
      </div>
      <div class="well-stats">
       <div>
        total thrown:
        <span id="wellTotalThrown">
         0
        </span>
        points
       </div>
       <div>
        total received:
        <span id="wellTotalReceived">
         0
        </span>
        points
       </div>
       <div>
        times thrown:
        <span id="wellTimesThrown">
         0
        </span>
       </div>
       <div>
        success rate:
        <span id="wellSuccessRate">
         0%
        </span>
       </div>
      </div>
     </div>
    </div>
    <div class="page" id="page-4">
     <h2 style="margin-top: 0; margin-bottom: 20px;">
      settings
     </h2>
     <div style="width: 100%; max-width: 400px; font-size: 0.9em; padding: 0 20px;">
      <label style="display: block; margin-top: 12px;">
       theme:
      </label>
      <select id="themeSelect" style="width: 100%; margin-top: 4px;">
       <option value="black">
        black (default)
       </option>
       <option value="white">
        white
       </option>
       <option value="custom">
        custom
       </option>
      </select>
      <input id="customColor" style="display:none; width: 100%; margin-top: 8px;" type="color"/>
      <label style="display: block; margin-top: 16px;">
       text size:
      </label>
      <input id="textSize" max="28" min="12" style="width: 100%; margin-top: 4px;" type="range" value="16"/>
      <label style="display: block; margin-top: 12px;">
       <input id="rgbBg" type="checkbox"/>
       RGB background
      </label>
      <label style="display: block; margin-top: 8px;">
       <input id="wackyText" type="checkbox"/>
       wacky text size
      </label>
      <label style="display: block; margin-top: 8px;">
       <input id="chaosMode" type="checkbox"/>
       ADHD mode
      </label>
      <hr class="sep" style="margin: 20px 0;"/>
      <label style="display: block; margin-top: 12px;">
       font:
      </label>
      <select id="fontSelect" style="width: 100%; margin-top: 4px;">
       <option value="default">
        default
       </option>
       <option value="serif">
        serif
       </option>
       <option value="mono">
        monospace
       </option>
       <option value="dyslexic">
        OpenDyslexic
       </option>
      </select>
      <label style="display: block; margin-top: 16px;">
       seasonal particles:
      </label>
      <select id="seasonSelect" style="width: 100%; margin-top: 4px;">
       <option value="none">
        none
       </option>
       <option value="winter">
        winter âï¸
       </option>
       <option value="spring">
        spring ð¸
       </option>
       <option value="summer">
        summer âï¸
       </option>
       <option value="fall">
        fall ð
       </option>
      </select>
      <label style="display: block; margin-top: 12px;">
       <input id="devOverlay" type="checkbox"/>
       developer overlay
      </label>
      <label style="display: block; margin-top: 8px;">
       <input id="muteMusic" type="checkbox"/>
       mute music
      </label>
      <label style="display: block; margin-top: 8px;">
       <input id="legacyMode" type="checkbox"/>
       legacy layout
      </label>
      <hr class="sep" style="margin: 20px 0;"/>
      <label style="display: block; margin-top: 12px;">
       background music:
      </label>
      <select id="musicSelect" style="width: 100%; margin-top: 4px;">
       <option value="default">
        Toby Fox - WELCOME TO THE CITY (default)
       </option>
       <option value="levelup">
        leon chang - wavelocity
       </option>
       <option value="nocturne">
        Chopin - Nocturne op.9 No.2
       </option>
       <option value="moonlight">
        Beethoven - Moonlight Sonata (full)
       </option>
      </select>
      <label style="display: block; margin-top: 16px;">
       upload custom music:
      </label>
      <input accept="audio/*" id="customMusicUpload" style="width: 100%; margin-top: 4px; padding: 4px;" type="file"/>
      <small class="helper" style="margin-top: 4px;">
       max 10MB - will be saved locally
      </small>
      <div id="customMusicList" style="margin-top: 12px; display: none;">
       <label style="display: block; margin-bottom: 8px;">
        your custom tracks:
       </label>
       <div id="customTracksList">
       </div>
      </div>
      <hr class="sep" style="margin: 20px 0;"/>
      <label style="display: block; margin-top: 12px;">
       particle density:
      </label>
      <select id="particleDensity" style="width: 100%; margin-top: 4px;">
       <option value="low">
        low (50 particles)
       </option>
       <option value="medium">
        medium (200 particles)
       </option>
       <option value="high">
        high (400 particles)
       </option>
      </select>
      <label style="display: block; margin-top: 16px;">
       background pattern:
      </label>
      <select id="bgPattern" style="width: 100%; margin-top: 4px;">
       <option value="none">
        none (solid)
       </option>
       <option value="dots">
        dots
       </option>
       <option value="grid">
        grid
       </option>
       <option value="waves">
        waves
       </option>
       <option value="diagonal">
        diagonal lines
       </option>
      </select>
      <label style="display: block; margin-top: 16px;">
       custom roll button text:
      </label>
      <input id="customRollText" maxlength="30" placeholder="roll" style="width: 100%; margin-top: 4px; padding: 8px;" type="text"/>
      <div id="settingsTransferContainer" style="margin-top: 20px;">
       <div style="margin-bottom: 6px; opacity: 0.7;">
        settings transfer
       </div>
       <div id="settingsTransferCode" style="font-size: 0.75em; word-break: break-all; background: var(--overlay-bg); border: 1px solid var(--border-color); padding: 6px 8px; border-radius: 3px; max-height: 3.5em; overflow: hidden; margin-bottom: 6px; user-select: all; opacity: 0.6; transition: max-height 0.2s ease;">
        eyJwIjoie1widXNlclNldHRpbmdzXCI6XCJ7XFxcInRoZW1lXFxcIjpcXFwiYmxhY2tcXFwiLFxcXCJjdXN0b21IZXhcXFwiOlxcXCIjMGUwZTBlXFxcIixcXFwidGV4dFNpemVcXFwiOjE2LFxcXCJyZ2JcXFwiOmZhbHNlLFxcXCJ3YWNreVxcXCI6ZmFsc2UsXFxcImNoYW9zXFxcIjpmYWxzZSxcXFwibXVzaWNcXFwiOlxcXCJkZWZhdWx0XFxcIixcXFwiZm9udFxcXCI6XFxcImRlZmF1bHRcXFwiLFxcXCJzZWFzb25cXFwiOlxcXCJub25lXFxcIixcXFwiZGV2XFxcIjpmYWxzZSxcXFwibXV0ZWRcXFwiOmZhbHNlLFxcXCJwYXJ0aWNsZURlbnNpdHlcXFwiOlxcXCJtZWRpdW1cXFwiLFxcXCJiZ1BhdHRlcm5cXFwiOlxcXCJub25lXFxcIixcXFwiY3VzdG9tUm9sbFRleHRcXFwiOlxcXCJcXFwiLFxcXCJsZWdhY3lNb2RlXFxcIjpmYWxzZX1cIn0iLCJoIjoiZThiZTZjMzEiLCJ0Ijoic2V0dGluZ3MifQ==
       </div>
       <div style="display: flex; gap: 6px; flex-wrap: wrap; align-items: center;">
        <button class="small" id="exportSettingsBtn">
         copy
        </button>
        <button class="small" id="downloadSettingsBtn">
         download
        </button>
        <button class="small" id="refreshSettingsBtn">
         refresh
        </button>
        <button class="small" id="importSettingsBtn">
         import
        </button>
        <button class="small" id="showMoreSettingsBtn" style="opacity: 0.5; display: inline-block;">
         show more
        </button>
       </div>
      </div>
      <div id="saveTransferContainer" style="margin-top: 14px;">
       <div style="margin-bottom: 6px; opacity: 0.7;">
        save data transfer
       </div>
       <div id="saveTransferCode" style="font-size: 0.75em; word-break: break-all; background: var(--overlay-bg); border: 1px solid var(--border-color); padding: 6px 8px; border-radius: 3px; max-height: 3.5em; overflow: hidden; margin-bottom: 6px; user-select: all; opacity: 0.6; transition: max-height 0.2s ease;">
        (no save data)
       </div>
       <div style="display: flex; gap: 6px; flex-wrap: wrap; align-items: center;">
        <button class="small" id="exportSaveBtn">
         copy
        </button>
        <button class="small" id="downloadSaveBtn">
         download
        </button>
        <button class="small" id="refreshSaveBtn">
         refresh
        </button>
        <button class="small" id="importSaveBtn">
         import
        </button>
        <button class="small" id="showMoreSaveBtn" style="opacity: 0.5; display: none;">
         show more (do not press)
        </button>
       </div>
      </div>
     </div>
    </div>
    <div class="page" id="page-5">
     <h2 style="margin-top: 0;">
      links and more
     </h2>
     <button class="lazy" data-observed="true" id="rankedModeBtn" style="margin-bottom: 20px; width: 100%; max-width: 400px; font-size: 1.1em; padding: 12px; background: linear-gradient(90deg, #ff6b6b, #4ecdc4); color: #000; border: none; font-weight: bold;">
      ranked mode
     </button>
     <script>
      const rankedBtn = document.getElementById('rankedModeBtn');
    rankedBtn.addEventListener('click', function() {
      window.location.href = 'https://authsrng.neocities.org/ranked.html';
    });
     </script>
     <div class="lazy" data-observed="true" id="resetContainer">
      <button id="resetBtn">
       reset data...
      </button>
     </div>
     <button class="lazy" data-observed="true" id="generateRunCard" style="margin-top: 10px;">
      generate run card
     </button>
     <button class="lazy" data-observed="true" id="link-txt-btn" style="margin-top: 10px;">
      connect with txt
     </button>
     <script>
      function generateToken(length=16){
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"
      let token = ""
      for(let i=0;i<length;i++) token += chars.charAt(Math.floor(Math.random()*chars.length))
      return token
    }

    document.getElementById("link-txt-btn").addEventListener("click", () => {
      const token = generateToken()
      window.location.href = "https://txt-ctgm.onrender.com/verify-rng?token=" + token
    })
     </script>
     <div class="lazy" data-observed="true" id="playtimeDisplay">
      total playtime: 6s
     </div>
     <br/>
     <br/>
     <a class="lazy" data-observed="true" href="html/credits.html">
      credits
     </a>
     <a class="lazy" data-observed="true" href="html/FAQ.html">
      FAQ
     </a>
     <a class="lazy" data-observed="true" href="http://authsrng.web.fc2.com/">
      lite version (old browsers only)
     </a>
     <br/>
     <br/>
     <p>
      join us on...
     </p>
     <div class="image-column">
      <a class="image-link" href="https://github.com/auth1ery/auths-RNG">
       <span class="link-text">
        github
       </span>
      </a>
      <a class="image-link" href="https://discord.gg/mTDw8jJYqX">
       <span class="link-text">
        discord
       </span>
      </a>
      <a class="image-link" href="https://www.reddit.com/r/authsRNG/">
       <span class="link-text">
        reddit
       </span>
      </a>
      <a class="image-link" href="https://txt-ctgm.onrender.com/">
       <span class="link-text">
        txt
       </span>
      </a>
     </div>
     <br/>
     <br/>
     <p>
      more links...
     </p>
     <div class="image-column">
      <a class="image-link" href="https://stats.uptimerobot.com/TAmAzlTA1g">
       <span class="link-text">
        status
       </span>
      </a>
      <a class="image-link" href="html/LICENSE.txt.html">
       <span class="link-text">
        license
       </span>
      </a>
      <a class="image-link" href="https://authguy.nekoweb.org">
       <span class="link-text">
        about me
       </span>
      </a>
     </div>
     <br/>
     <br/>
     <a href="http://s01.flagcounter.com/more/iljn">
      <img alt="Flag Counter" border="0" src="images/image_5.jpg"/>
     </a>
     <img src="images/hit"/>
     <br/>
     <br/>
     <br/>
     <br/>
     <p>
      feed my pet while you're at it:
     </p>
     <a href="https://tamanotchi.world/29830c">
      <img alt="It's tamaNOTchi! Click to feed!" src="images/29830"/>
     </a>
    </div>
   </div>
   <div class="page-dots">
    <div class="page-dot active" data-page="0">
    </div>
    <div class="page-dot" data-page="1">
    </div>
    <div class="page-dot" data-page="2">
    </div>
    <div class="page-dot" data-page="3">
    </div>
    <div class="page-dot" data-page="4">
    </div>
   </div>
   <button class="page-arrow left" disabled="" id="prevPage">
    â¹
   </button>
   <button class="page-arrow right" id="nextPage">
    âº
   </button>
   <div class="swipe-indicator show">
    â swipe to navigate â
   </div>
   <script src="js/main.js">
   </script>
   <div id="cutsceneOverlay">
    <video id="cutsceneVideo" preload="auto">
    </video>
   </div>
   <div id="custom-cursor" style="display: none;">
    <div class="circle">
    </div>
    <div class="dot">
    </div>
    <div class="plus">
    </div>
   </div>
   <div id="anomalyPopup">
   </div>
   <div id="luckBoostOverlay">
    <div id="luckTimer">
     60
    </div>
    <div id="luckFooter">
     4x luck
    </div>
   </div>
   <div id="devOverlayPanel" style="display: none;">
   </div>
   <canvas id="seasonCanvas">
   </canvas>
   <div id="interaction-lightup">
   </div>
   <div id="indexModal">
    <div class="index-content">
     <div class="index-header">
      <h3 style="margin: 0;">
       rarity index
      </h3>
      <button class="index-close" id="indexClose">
       Ã
      </button>
     </div>
     <div class="index-stats" id="indexStats">
      0/0 collected
     </div>
     <input class="index-search" id="indexSearch" placeholder="search rarities..." type="text"/>
     <div class="index-list" id="indexList">
     </div>
    </div>
   </div>
   <div class="well-result" id="wellResultModal">
    <div class="well-result-icon" id="wellResultIcon">
     wee
    </div>
    <div class="well-result-text" id="wellResultText">
     the well grants your wish!
    </div>
    <div class="well-result-amount" id="wellResultAmount">
     +100 points
    </div>
    <button class="well-result-close" onclick="closeWellResult()">
     okay
    </button>
   </div>
   <div class="active-potions-display" id="activePotionsDisplay" style="display: none;">
    <div class="active-potions-title">
     active potions
    </div>
    <div id="activePotionsList">
    </div>
   </div>
   <script>
    const toggleBtn = document.createElement('button');
    toggleBtn.textContent = "auto roll (OFF)";
    toggleBtn.id = "autoRollBtn";
    document.body.appendChild(toggleBtn);

    let autoRollInterval = null;

    toggleBtn.addEventListener('click', () => {
      toggleBtn.classList.toggle('active');
      const isActive = toggleBtn.classList.contains('active');
      toggleBtn.textContent = isActive ? "auto roll (ON)" : "auto roll (OFF)";

      if (isActive) {
        autoRollInterval = setInterval(() => {
          const rollBtn = document.getElementById('rollBtn');
          if (rollBtn && !rollBtn.disabled) rollBtn.click();
        }, 500);
      } else {
        clearInterval(autoRollInterval);
      }
    });
   </script>
   <script>
    const themeSelect = document.getElementById("themeSelect");
  const customColor = document.getElementById("customColor");
  const textSize = document.getElementById("textSize");
  const rgbBg = document.getElementById("rgbBg");
  const wackyText = document.getElementById("wackyText");
  const chaosMode = document.getElementById("chaosMode");
  const musicSelect = document.getElementById("musicSelect");
  const fontSelect = document.getElementById("fontSelect");
  const seasonSelect = document.getElementById("seasonSelect");
  const devOverlayCheck = document.getElementById("devOverlay");
  const devPanel = document.getElementById("devOverlayPanel");
  const seasonCanvas = document.getElementById("seasonCanvas");
  const seasonCtx = seasonCanvas.getContext("2d");
  const muteMusicCheck = document.getElementById("muteMusic");
  const particleDensitySelect = document.getElementById("particleDensity");
  const bgPatternSelect = document.getElementById("bgPattern");
  const customRollTextInput = document.getElementById("customRollText");
  const legacyModeCheck = document.getElementById('legacyMode');

  let particles = [];
  let particleInterval = null;
  let devInterval = null;
  let rgbInterval = null;
  let wackyInterval = null;

  const musicLinks = {
    default: "https://files.catbox.moe/y2mn5w.mp3",
    levelup: "https://files.catbox.moe/3mdxes.mp3",
    nocturne: "https://files.catbox.moe/k7i9oy.mp3",
    moonlight: "https://files.catbox.moe/zdjc7s.mp3"
  };

  let visibilityListenerAdded = false;

  function applyBackgroundPattern(pattern) {
    const body = document.body;
    body.style.backgroundImage = '';
    body.style.backgroundSize = '';
    body.style.backgroundRepeat = '';

    if (pattern === 'none') return;

    const isLightTheme = document.body.getAttribute('data-theme') === 'white';
    const patternColor = isLightTheme ? '0,0,0' : '220,220,220';

    if (pattern === 'dots') {
      body.style.backgroundImage = `radial-gradient(circle, rgba(${patternColor},0.1) 1px, transparent 1px)`;
      body.style.backgroundSize = '20px 20px';
    } else if (pattern === 'grid') {
      body.style.backgroundImage = `
        linear-gradient(rgba(${patternColor},0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(${patternColor},0.05) 1px, transparent 1px)
      `;
      body.style.backgroundSize = '20px 20px';
    } else if (pattern === 'waves') {
      body.style.backgroundImage = `repeating-linear-gradient(
        45deg,
        transparent,
        transparent 10px,
        rgba(${patternColor},0.03) 10px,
        rgba(${patternColor},0.03) 20px
      )`;
    } else if (pattern === 'diagonal') {
      body.style.backgroundImage = `repeating-linear-gradient(
        45deg,
        transparent,
        transparent 15px,
        rgba(${patternColor},0.05) 15px,
        rgba(${patternColor},0.05) 16px
      )`;
    }
  }

  function applyCustomRollText(text) {
    const rollBtn = document.getElementById('rollBtn');
    if (rollBtn) {
      rollBtn.textContent = text.trim() || 'roll';
    }
  }

  function startSeasonalParticles(season, density = 'medium') {
    if (particleInterval) clearInterval(particleInterval);
    particles = [];
    seasonCtx.clearRect(0, 0, seasonCanvas.width, seasonCanvas.height);

    const validSeasons = ["winter", "spring", "summer", "fall"];
    if (!validSeasons.includes(season)) return;

    const emojiMap = {
      winter: "âï¸",
      spring: "ð¸",
      summer: "âï¸",
      fall: "ð"
    };
    const emoji = emojiMap[season];

    const w = seasonCanvas.width = window.innerWidth;
    const h = seasonCanvas.height = window.innerHeight;

    const densityMap = {
      low: 50,
      medium: 200,
      high: 400
    };
    const MAX_PARTICLES = densityMap[density] || 200;

    function addParticle() {
      if (particles.length >= MAX_PARTICLES) return;
      particles.push({
        x: Math.random() * w,
        y: -20,
        speed: 1 + Math.random() * 2,
        drift: (Math.random() - 0.5) * 1.2,
        size: 14,
        char: emoji,
        alpha: 0.4 + Math.random() * 0.3
      });
    }

    function startInterval() {
      if (particleInterval) clearInterval(particleInterval);
      particleInterval = setInterval(addParticle, 120);
    }
    startInterval();

    if (!visibilityListenerAdded) {
      document.addEventListener("visibilitychange", () => {
        if (document.hidden) {
          if (particleInterval) clearInterval(particleInterval);
        } else if (seasonSelect.value !== "none") {
          startInterval();
        }
      });
      visibilityListenerAdded = true;
    }

    function loop() {
      seasonCtx.clearRect(0, 0, w, h);
      particles.forEach(p => {
        p.y += p.speed;
        p.x += p.drift;
        seasonCtx.globalAlpha = p.alpha;
        seasonCtx.font = p.size + "px sans-serif";
        seasonCtx.fillText(p.char, p.x, p.y);
      });
      particles = particles.filter(p => p.y < h + 30);
      requestAnimationFrame(loop);
    }
    loop();
  }

let lastTime = performance.now();
let frameCount = 0;
let lastFPSUpdate = performance.now();
let currentFPS = 0;
let domUpdateCount = 0;

// Create toggle button for dev overlay
const devToggleBtn = document.createElement('button');
devToggleBtn.id = 'devOverlayToggle';
devToggleBtn.textContent = 'hide dev';
document.body.appendChild(devToggleBtn);

let devCollapsed = false;
devToggleBtn.addEventListener('click', () => {
  devCollapsed = !devCollapsed;
  if (devCollapsed) {
    devPanel.classList.add('collapsed');
    devToggleBtn.textContent = 'show dev';
  } else {
    devPanel.classList.remove('collapsed');
    devToggleBtn.textContent = 'hide dev';
  }
});

  function applySettings(settings) {
    if (settings.legacyMode) {
      document.body.classList.add('legacy-mode');
    } else {
      document.body.classList.remove('legacy-mode');
    }
    if (settings.theme === "white") {
      document.body.setAttribute('data-theme', 'white');
    } else if (settings.theme === "custom") {
      document.body.removeAttribute('data-theme');
      document.body.style.setProperty('--bg-color', settings.customHex || '#0e0e0e');
      document.body.style.setProperty('--text-color', '#dcdcdc');
    } else {
      document.body.removeAttribute('data-theme');
    }

    document.body.style.fontSize = (settings.textSize || 16) + "px";

    if (settings.font === "serif") document.body.style.fontFamily = "serif";
    else if (settings.font === "mono") document.body.style.fontFamily = "monospace";
    else if (settings.font === "dyslexic") document.body.style.fontFamily = "'OpenDyslexic', sans-serif";
    else document.body.style.fontFamily = "monospace";

clearInterval(devInterval);
if (settings.dev) {
  devPanel.style.display = "block";
  devToggleBtn.style.display = "block";
  devInterval = setInterval(() => {
    // Calculate FPS
    frameCount++;
    const now = performance.now();
    if (now - lastFPSUpdate >= 1000) {
      currentFPS = Math.round((frameCount * 1000) / (now - lastFPSUpdate));
      frameCount = 0;
      lastFPSUpdate = now;
    }
    
    // Get memory info
    const memInfo = performance.memory ? {
      used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024),
      total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024),
      limit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024)
    } : null;
    
    // Get game state from localStorage
    let gameData = {};
    try {
      const saved = localStorage.getItem('gameState');
      if (saved) gameData = JSON.parse(saved);
    } catch(e) {}
    
    // Count DOM elements
    const totalElements = document.getElementsByTagName('*').length;
    const visibleElements = Array.from(document.querySelectorAll('*')).filter(el => {
      const style = window.getComputedStyle(el);
      return style.display !== 'none' && style.visibility !== 'hidden';
    }).length;
    
    // Get event listeners count (approximate)
    const clickableElements = document.querySelectorAll('button, a, [onclick], input, select').length;
    
    // Network timing
    const navTiming = performance.getEntriesByType('navigation')[0];
    const loadTime = navTiming ? Math.round(navTiming.loadEventEnd - navTiming.fetchStart) : 0;
    
    // Build debug output
    let output = '';
    
    // Performance section
    output += '<div class="dev-section">';
    output += '<div class="dev-header">PERFORMANCE</div>';
    output += `<span class="dev-label">FPS:</span> <span class="dev-value ${currentFPS < 30 ? 'dev-error' : currentFPS < 50 ? 'dev-warning' : 'dev-success'}">${currentFPS}</span><br>`;
    output += `<span class="dev-label">Frame Time:</span> <span class="dev-value">${(1000/currentFPS).toFixed(2)}ms</span><br>`;
    output += `<span class="dev-label">Page Load:</span> <span class="dev-value">${loadTime}ms</span><br>`;
    if (memInfo) {
      const memPercent = ((memInfo.used / memInfo.limit) * 100).toFixed(1);
      output += `<span class="dev-label">Memory:</span> <span class="dev-value ${memPercent > 80 ? 'dev-error' : memPercent > 60 ? 'dev-warning' : ''}">${memInfo.used}MB / ${memInfo.limit}MB (${memPercent}%)</span><br>`;
    }
    output += `<span class="dev-label">Particles:</span> <span class="dev-value">${particles.length}</span><br>`;
    output += `<span class="dev-label">Intervals:</span> <span class="dev-value">${[particleInterval, devInterval, rgbInterval, wackyInterval].filter(x => x).length}</span>`;
    output += '</div>';
    
    // DOM section
    output += '<div class="dev-section">';
    output += '<div class="dev-header">DOM TREE</div>';
    output += `<span class="dev-label">Total Elements:</span> <span class="dev-value">${totalElements}</span><br>`;
    output += `<span class="dev-label">Visible Elements:</span> <span class="dev-value">${visibleElements}</span><br>`;
    output += `<span class="dev-label">Interactive Elements:</span> <span class="dev-value">${clickableElements}</span><br>`;
    output += `<span class="dev-label">DOM Updates:</span> <span class="dev-value">${domUpdateCount}</span><br>`;
    
    // Key DOM elements
    const buttons = document.querySelectorAll('button').length;
    const inputs = document.querySelectorAll('input, select').length;
    const links = document.querySelectorAll('a').length;
    const images = document.querySelectorAll('img, canvas').length;
    output += `<span class="dev-label">Buttons:</span> <span class="dev-value">${buttons}</span> `;
    output += `<span class="dev-label">Inputs:</span> <span class="dev-value">${inputs}</span> `;
    output += `<span class="dev-label">Links:</span> <span class="dev-value">${links}</span> `;
    output += `<span class="dev-label">Images:</span> <span class="dev-value">${images}</span>`;
    output += '</div>';
    
    // Game state section
    output += '<div class="dev-section">';
    output += '<div class="dev-header">GAME STATE</div>';
    output += `<span class="dev-label">Total Rolls:</span> <span class="dev-value">${gameData.totalRolls || 0}</span><br>`;
    output += `<span class="dev-label">Points:</span> <span class="dev-value">${gameData.points || 0}</span><br>`;
    output += `<span class="dev-label">Inventory:</span> <span class="dev-value">${gameData.inventory ? Object.keys(gameData.inventory).length : 0} items</span><br>`;
    output += `<span class="dev-label">Anomalies:</span> <span class="dev-value">${gameData.anomalies || 0}</span><br>`;
    output += `<span class="dev-label">Luck Multiplier:</span> <span class="dev-value">${gameData.currentLuck || 1.0}x</span>`;
    output += '</div>';
    
    // Upgrades section
    if (gameData.upgrades) {
      output += '<div class="dev-section">';
      output += '<div class="dev-header">UPGRADES</div>';
      output += `<span class="dev-label">Luck:</span> <span class="dev-value">${gameData.upgrades.luck || 0}/100</span><br>`;
      output += `<span class="dev-label">Speed:</span> <span class="dev-value">${gameData.upgrades.speed || 0}/3</span><br>`;
      output += `<span class="dev-label">Points:</span> <span class="dev-value">${gameData.upgrades.points || 0}/10</span>`;
      output += '</div>';
    }
    
    // LocalStorage section
    output += '<div class="dev-section">';
    output += '<div class="dev-header">LOCALSTORAGE</div>';
    let lsSize = 0;
    let lsKeys = [];
    try {
      for (let key in localStorage) {
        if (localStorage.hasOwnProperty(key)) {
          const itemSize = (localStorage[key].length + key.length);
          lsSize += itemSize;
          lsKeys.push({key, size: itemSize});
        }
      }
      lsKeys.sort((a, b) => b.size - a.size);
      const lsKB = (lsSize / 1024).toFixed(2);
      const lsPercent = ((lsSize / (5 * 1024 * 1024)) * 100).toFixed(1);
      output += `<span class="dev-label">Total:</span> <span class="dev-value ${lsPercent > 80 ? 'dev-warning' : ''}">${lsKB}KB (${lsPercent}%)</span><br>`;
      output += `<span class="dev-label">Keys:</span> <span class="dev-value">${lsKeys.length}</span><br>`;
      output += '<span class="dev-label">Top Keys:</span><br>';
      lsKeys.slice(0, 3).forEach(item => {
        output += `<span class="dev-key">  ${item.key}:</span> <span class="dev-value">${(item.size / 1024).toFixed(2)}KB</span><br>`;
      });
    } catch(e) {}
    output += '</div>';
    
    // System info
    output += '<div class="dev-section">';
    output += '<div class="dev-header">SYSTEM</div>';
    output += `<span class="dev-label">Browser:</span> <span class="dev-value">${navigator.userAgent.match(/(Chrome|Firefox|Safari|Edge)\/[\d.]+/)?.[0] || 'Unknown'}</span><br>`;
    output += `<span class="dev-label">Screen:</span> <span class="dev-value">${window.innerWidth}x${window.innerHeight}</span><br>`;
    output += `<span class="dev-label">Device Pixel Ratio:</span> <span class="dev-value">${window.devicePixelRatio}x</span><br>`;
    output += `<span class="dev-label">Current Page:</span> <span class="dev-value">${typeof currentPage !== 'undefined' ? currentPage + 1 : 1}/5</span><br>`;
    output += `<span class="dev-label">Theme:</span> <span class="dev-value">${settings.theme || 'black'}</span><br>`;
    output += `<span class="dev-label">Season:</span> <span class="dev-value">${settings.season || 'none'}</span><br>`;
    output += `<span class="dev-label">Online:</span> <span class="dev-value ${navigator.onLine ? 'dev-success' : 'dev-error'}">${navigator.onLine ? 'YES' : 'NO'}</span>`;
    output += '</div>';
    
    // Event Listeners
    output += '<div class="dev-section">';
    output += '<div class="dev-header">EVENT LISTENERS</div>';
    const eventCounts = {
      click: document.querySelectorAll('[onclick]').length,
      change: document.querySelectorAll('input, select').length,
      keydown: 1,
      mousemove: window.matchMedia("(pointer: fine)").matches ? 1 : 0,
      touchstart: 1,
      touchend: 1
    };
    for (let [event, count] of Object.entries(eventCounts)) {
      if (count > 0) {
        output += `<span class="dev-label">${event}:</span> <span class="dev-value">${count}</span> `;
      }
    }
    output += '</div>';
    
    output += '<div class="dev-section">';
    output += '<div class="dev-header">ELEMENTS</div>';
    const keyElements = [
      {selector: '#rollBtn', name: 'Roll Button'},
      {selector: '#inventoryList', name: 'Inventory'},
      {selector: '#spinner', name: 'Spinner'},
      {selector: '.page-dot', name: 'Page Dots'},
      {selector: '#devOverlayPanel', name: 'Dev Panel'},
      {selector: '#seasonCanvas', name: 'Particles Canvas'},
      {selector: '#custom-cursor', name: 'Custom Cursor'}
    ];
    
    keyElements.forEach(({selector, name}) => {
      const el = document.querySelector(selector);
      if (el) {
        const visible = window.getComputedStyle(el).display !== 'none';
        output += `<span class="dev-dom-tag">${name}:</span> <span class="${visible ? 'dev-success' : 'dev-warning'}">${visible ? 'â' : 'â'}</span> `;
      }
    });
    output += '</div>';
    
    devPanel.innerHTML = output;
    lastTime = performance.now();
  }, 250);
} else {
  devPanel.style.display = "none";
  devToggleBtn.style.display = "none";
}

if (settings.muted) {
  if (window.backgroundMusic) {
    window.backgroundMusic.pause();
    window.backgroundMusic.volume = 0;
    window.backgroundMusic.src = ''; // Clear source
  }
  if (window.lunarMusic) {
    window.lunarMusic.pause();
    window.lunarMusic.volume = 0;
  }
  if (window.stopCustomAudio) {
    window.stopCustomAudio();
  }
} else {
  // Check if it's a custom track
  if (settings.music && settings.music.startsWith('custom_')) {
    try {
      // stop and clear regular background music completely or else it'll sound like mashed goop... ewwwwwwwwwww
      if (window.backgroundMusic) {
        window.backgroundMusic.pause();
        window.backgroundMusic.src = ''; // Clear the source to stop it completely
        window.backgroundMusic.load(); // Reset the audio element
      }
      
      const customMusic = JSON.parse(localStorage.getItem('customMusic') || '[]');
      const index = parseInt(settings.music.replace('custom_', ''));
      if (customMusic[index] && window.playCustomAudio) {
        window.playCustomAudio(customMusic[index].data, 0.3, true).catch(function(e) {
          console.error('Failed to play custom audio:', e);
          // Fallback to default
          if (window.stopCustomAudio) {
            window.stopCustomAudio();
          }
          if (window.backgroundMusic) {
            window.backgroundMusic.src = musicLinks["default"];
            window.backgroundMusic.volume = 0.3;
            window.backgroundMusic.loop = true;
            window.backgroundMusic.play().catch(function() {});
          }
        });
      }
    } catch(e) {
      console.error('Error loading custom music:', e);
      if (window.backgroundMusic) {
        window.backgroundMusic.src = musicLinks["default"];
        window.backgroundMusic.volume = 0.3;
        window.backgroundMusic.loop = true;
      }
    }
  } else {
    // Stop custom audio if playing
    if (window.stopCustomAudio) {
      window.stopCustomAudio();
    }
    
    // Play regular music
    if (window.backgroundMusic) {
      window.backgroundMusic.src = musicLinks[settings.music || "default"];
      window.backgroundMusic.volume = 0.3;
      window.backgroundMusic.loop = true;
      // Try to play, but don't worry if it fails (autoplay restrictions)
      window.backgroundMusic.play().catch(function() {});
    }
  }
  
  if (window.lunarMusic) {
    window.lunarMusic.volume = 0.6;
  }
}
    
    if (muteMusicCheck) muteMusicCheck.checked = !!settings.muted;
    if (themeSelect) themeSelect.value = settings.theme || "black";
    if (customColor) {
      customColor.value = settings.customHex || "#0e0e0e";
      customColor.style.display = settings.theme === "custom" ? "block" : "none";
    }
    if (textSize) textSize.value = settings.textSize || 16;
    if (rgbBg) rgbBg.checked = !!settings.rgb;
    if (wackyText) wackyText.checked = !!settings.wacky;
    if (chaosMode) chaosMode.checked = !!settings.chaos;
    if (musicSelect) musicSelect.value = settings.music || "default";
    if (particleDensitySelect) particleDensitySelect.value = settings.particleDensity || 'medium';
    if (bgPatternSelect) bgPatternSelect.value = settings.bgPattern || 'none';
    if (customRollTextInput) customRollTextInput.value = settings.customRollText || '';

    applyBackgroundPattern(settings.bgPattern || 'none');
    applyCustomRollText(settings.customRollText || '');

    clearInterval(rgbInterval);
    rgbInterval = null;
    clearInterval(wackyInterval);
    wackyInterval = null;

    if (settings.rgb || settings.chaos) {
      rgbInterval = setInterval(() => {
        const h = Math.floor(Math.random() * 360);
        const lightness = settings.theme === "white" ? 90 : 15;
        document.body.style.backgroundColor = `hsl(${h}, 70%, ${lightness}%)`;
        applyBackgroundPattern(settings.bgPattern || 'none');
      }, 150);
    } else {
      if (settings.theme === "white") {
        document.body.style.backgroundColor = '';
      } else if (settings.theme === "custom") {
        document.body.style.backgroundColor = settings.customHex || '#0e0e0e';
      } else {
        document.body.style.backgroundColor = '';
      }
    }

    if (settings.wacky || settings.chaos) {
      wackyInterval = setInterval(() => {
        const size = Math.floor(Math.random() * 10) + 16;
        document.body.style.fontSize = size + "px";
      }, 200);
    }

    try {
      localStorage.setItem("userSettings", JSON.stringify(settings));
    } catch (e) {
      console.warn(e);
    }
    
    startSeasonalParticles(settings.season, settings.particleDensity || 'medium');
  }

function getCurrentSettings() {
  return {
    theme: themeSelect ? themeSelect.value : "black",
    customHex: customColor ? customColor.value : "#0e0e0e",
    textSize: textSize ? parseInt(textSize.value, 10) : 16,
    rgb: rgbBg ? rgbBg.checked : false,
    wacky: wackyText ? wackyText.checked : false,
    chaos: chaosMode ? chaosMode.checked : false,
    music: musicSelect ? musicSelect.value : "default",
    font: fontSelect ? fontSelect.value : "default",
    season: seasonSelect ? seasonSelect.value : "none",
    dev: devOverlayCheck ? devOverlayCheck.checked : false,
    muted: muteMusicCheck ? muteMusicCheck.checked : false,
    particleDensity: particleDensitySelect ? particleDensitySelect.value : 'medium',
    bgPattern: bgPatternSelect ? bgPatternSelect.value : 'none',
    customRollText: customRollTextInput ? customRollTextInput.value : '',
    legacyMode: document.getElementById('legacyMode') ? document.getElementById('legacyMode').checked : false
  };
}

  if (themeSelect) {
    themeSelect.addEventListener("change", () => {
      if (customColor) customColor.style.display = themeSelect.value === "custom" ? "block" : "none";
      applySettings(getCurrentSettings());
    });
  }
  if (customColor) customColor.addEventListener("input", () => applySettings(getCurrentSettings()));
  if (textSize) textSize.addEventListener("input", () => applySettings(getCurrentSettings()));
  if (rgbBg) rgbBg.addEventListener("change", () => applySettings(getCurrentSettings()));
  if (wackyText) wackyText.addEventListener("change", () => applySettings(getCurrentSettings()));
  if (chaosMode) chaosMode.addEventListener("change", () => applySettings(getCurrentSettings()));
  if (musicSelect) musicSelect.addEventListener("change", () => applySettings(getCurrentSettings()));
  if (fontSelect) fontSelect.addEventListener("change", () => applySettings(getCurrentSettings()));
  if (seasonSelect) seasonSelect.addEventListener("change", () => applySettings(getCurrentSettings()));
  if (particleDensitySelect) particleDensitySelect.addEventListener("change", () => applySettings(getCurrentSettings()));
  if (bgPatternSelect) bgPatternSelect.addEventListener("change", () => applySettings(getCurrentSettings()));
  if (customRollTextInput) customRollTextInput.addEventListener("input", () => applySettings(getCurrentSettings()));
  if (devOverlayCheck) devOverlayCheck.addEventListener("change", () => applySettings(getCurrentSettings()));
  if (muteMusicCheck) muteMusicCheck.addEventListener("change", () => applySettings(getCurrentSettings()));
  if (legacyModeCheck) legacyModeCheck.addEventListener("change", () => applySettings(getCurrentSettings()));

  (function init() {
    const saved = localStorage.getItem("userSettings");
    if (saved) {
      try {
        applySettings(JSON.parse(saved));
      } catch (e) {}
    } else {
      const def = {
        theme: "black",
        customHex: "#0e0e0e",
        textSize: 16,
        rgb: false,
        wacky: false,
        chaos: false,
        music: "default",
        font: "default",
        season: "none",
        dev: false,
        muted: false,
        particleDensity: "medium",
        bgPattern: "none",
        customRollText: "",
        legacyMode: false
      };
      applySettings(def);
    }
  })();
   </script>
   <script>
    if (window.matchMedia("(pointer: fine)").matches) {
      const cursor = document.getElementById('custom-cursor');
      const plus = cursor.querySelector('.plus');

      let rotatePositive = true;

      window.addEventListener('mousemove', e => {
        cursor.style.left = e.clientX + 'px';
        cursor.style.top = e.clientY + 'px';
      });

      function animateClick() {
        cursor.style.transform = 'translate(-50%, -50%) scale(1.3)';
        cursor.classList.add('glow');

        if (rotatePositive) {
          plus.style.transform = 'translate(-50%, -50%) rotate(15deg)';
        } else {
          plus.style.transform = 'translate(-50%, -50%) rotate(-15deg)';
        }
        rotatePositive = !rotatePositive;

        setTimeout(() => {
          cursor.style.transform = 'translate(-50%, -50%) scale(1)';
          cursor.classList.remove('glow');
          plus.style.transform = 'translate(-50%, -50%) rotate(0deg)';
        }, 148);
      }

      window.addEventListener('mousedown', animateClick);
    } else {
      const cursor = document.getElementById('custom-cursor');
      if (cursor) cursor.style.display = 'none';
      document.body.style.cursor = '';
    }
   </script>
   <script>
    const lazyObserver = new IntersectionObserver(
      entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add("visible");
          } else {
            entry.target.classList.remove("visible");
          }
        });
      },
      {
        root: null,
        rootMargin: "120px",
        threshold: 0.4
      }
    );

    document.querySelectorAll(".lazy").forEach(el => {
      lazyObserver.observe(el);
    });

    function observeLazyElements() {
      document.querySelectorAll(".lazy").forEach(el => {
        if (!el.dataset.observed) {
          lazyObserver.observe(el);
          el.dataset.observed = "true";
        }
      });
    }

    const mutationObserver = new MutationObserver(() => {
      observeLazyElements();
    });

    mutationObserver.observe(document.body, {
      childList: true,
      subtree: true
    });
   </script>
   <script>
    (function() {
  const container = document.querySelector('.page-container');
  const dots = document.querySelectorAll('.page-dot');
  const prevBtn = document.getElementById('prevPage');
  const nextBtn = document.getElementById('nextPage');
  const swipeIndicator = document.querySelector('.swipe-indicator');
  
  let currentPage = 0;
  const totalPages = 5;
  
  // ???????????????????????????????????/
let visitCount = parseInt(localStorage.getItem('pageVisitCount') || '0');
if (visitCount < 6) {
  setTimeout(() => {
    swipeIndicator.classList.add('show');
    setTimeout(() => swipeIndicator.classList.remove('show'), 10000);
  }, 1000);
  localStorage.setItem('pageVisitCount', (visitCount + 1).toString());
}
  
function goToPage(index) {
  if (index < 0 || index >= totalPages) return;
  
  currentPage = index;
  container.style.transform = `translateX(-${currentPage * 100}%)`;
  
  const activePage = document.getElementById(`page-${currentPage + 1}`);
  if (activePage) {
    container.style.height = activePage.scrollHeight + 'px';
  }
  
  dots.forEach((dot, i) => {
    dot.classList.toggle('active', i === currentPage);
  });
  
  prevBtn.disabled = currentPage === 0;
  nextBtn.disabled = currentPage === totalPages - 1;
  
  localStorage.setItem('currentPage', currentPage.toString());
}
  
  prevBtn.addEventListener('click', () => goToPage(currentPage - 1));
  nextBtn.addEventListener('click', () => goToPage(currentPage + 1));
  
  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => goToPage(index));
  });
  
let touchStartX = 0;
let touchEndX = 0;
let touchStartY = 0;
let touchEndY = 0;

container.parentElement.addEventListener('touchstart', (e) => {
  touchStartX = e.changedTouches[0].screenX;
  touchStartY = e.changedTouches[0].screenY;
}, { passive: true });

container.parentElement.addEventListener('touchend', (e) => {
  touchEndX = e.changedTouches[0].screenX;
  touchEndY = e.changedTouches[0].screenY;
  handleSwipe();
}, { passive: true });

function handleSwipe() {
  const swipeThreshold = 80;
  const diffX = touchStartX - touchEndX;
  const diffY = touchStartY - touchEndY;
  
  if (Math.abs(diffX) > swipeThreshold && Math.abs(diffX) > Math.abs(diffY)) {
    if (diffX > 0) {
      if (currentPage < totalPages - 1) {
        goToPage(currentPage + 1);
      } else {
        const activeDot = document.querySelector('.page-dot.active');
        if (activeDot) {
          activeDot.classList.add('flash-red');
          setTimeout(() => activeDot.classList.remove('flash-red'), 300);
        }
      }
    } else if (diffX < 0) {
      if (currentPage > 0) {
        goToPage(currentPage - 1);
      } else {
        const activeDot = document.querySelector('.page-dot.active');
        if (activeDot) {
          activeDot.classList.add('flash-red');
          setTimeout(() => activeDot.classList.remove('flash-red'), 300);
        }
      }
    }
  }
}

  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') goToPage(currentPage - 1);
    if (e.key === 'ArrowRight') goToPage(currentPage + 1);
  });
  
  const savedPage = parseInt(localStorage.getItem('currentPage') || '0');
  goToPage(savedPage);
})();
   </script>
   <noscript>
    <div>
     TURN ON JAVASCRIPT YOU FOOL
     <br/>
    </div>
   </noscript>
   <script>
    // Legacy mode
(function() {
  const legacyShopBtn = document.getElementById('legacyShopBtn');
  const legacySettingsBtn = document.getElementById('legacySettingsBtn');
  const legacyShopPopup = document.getElementById('legacyShopPopup');
  const legacySettingsPopup = document.getElementById('legacySettingsPopup');
  
  let shopMoved = false;
  let settingsMoved = false;
  
  const page2 = document.querySelector('#page-2');
  const page4 = document.querySelector('#page-4');
  
  function moveShopToPopup() {
    if (shopMoved || !page2 || !legacyShopPopup) return;
    
    while (page2.firstChild) {
      legacyShopPopup.appendChild(page2.firstChild);
    }
    shopMoved = true;
  }
  
  function moveSettingsToPopup() {
    if (settingsMoved || !page4 || !legacySettingsPopup) return;
    
    while (page4.firstChild) {
      legacySettingsPopup.appendChild(page4.firstChild);
    }
    settingsMoved = true;
  }
  
  function restoreContent() {
    if (legacyShopPopup && page2) {
      while (legacyShopPopup.firstChild) {
        page2.appendChild(legacyShopPopup.firstChild);
      }
      shopMoved = false;
    }
    
    if (legacySettingsPopup && page4) {
      while (legacySettingsPopup.firstChild) {
        page4.appendChild(legacySettingsPopup.firstChild);
      }
      settingsMoved = false;
    }
  }
  
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.attributeName === 'class') {
        const isLegacy = document.body.classList.contains('legacy-mode');
        if (isLegacy) {
          moveShopToPopup();
          moveSettingsToPopup();
        } else {
          restoreContent();
          if (legacyShopPopup) legacyShopPopup.classList.remove('open');
          if (legacySettingsPopup) legacySettingsPopup.classList.remove('open');
        }
      }
    });
  });
  
  observer.observe(document.body, { attributes: true });
  
  if (document.body.classList.contains('legacy-mode')) {
    moveShopToPopup();
    moveSettingsToPopup();
  }
  
  if (legacyShopBtn) {
    legacyShopBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      if (legacyShopPopup) {
        legacyShopPopup.classList.toggle('open');
      }
      if (legacySettingsPopup) {
        legacySettingsPopup.classList.remove('open');
      }
    });
  }
  
  if (legacySettingsBtn) {
    legacySettingsBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      if (legacySettingsPopup) {
        legacySettingsPopup.classList.toggle('open');
      }
      if (legacyShopPopup) {
        legacyShopPopup.classList.remove('open');
      }
    });
  }
  
  document.addEventListener('click', (e) => {
    if (!legacyShopPopup || !legacySettingsPopup) return;
    
    // Check if click is inside shop popup or its descendants
    const clickedInShop = legacyShopPopup.contains(e.target);
    const clickedShopBtn = e.target.closest('#legacyShopBtn');
    
    // Check if click is inside settings popup or its descendants
    const clickedInSettings = legacySettingsPopup.contains(e.target);
    const clickedSettingsBtn = e.target.closest('#legacySettingsBtn');
    
    // Check if modal is open and click is inside it
    const modal = document.getElementById('confirmModal');
    const clickedInModal = modal && modal.style.display === 'flex' && modal.contains(e.target);
    
    // Only close if NOT clicking inside popup, button, or modal
    if (!clickedInShop && !clickedShopBtn && !clickedInModal) {
      legacyShopPopup.classList.remove('open');
    }
    
    if (!clickedInSettings && !clickedSettingsBtn && !clickedInModal) {
      legacySettingsPopup.classList.remove('open');
    }
  });
})();
   </script>
   <script>
    (function() {
  const customMusicUpload = document.getElementById('customMusicUpload');
  const customMusicList = document.getElementById('customMusicList');
  const customTracksList = document.getElementById('customTracksList');
  const musicSelect = document.getElementById('musicSelect');
  
  // Web Audio API context
  window.audioContext = null;
  window.customAudioSource = null;
  window.customAudioGain = null;
  window.customAudioBuffer = null;
  
  // Load custom music from localStorage
  function loadCustomMusic() {
    try {
      const customMusic = JSON.parse(localStorage.getItem('customMusic') || '[]');
      
      // Remove old custom options
      Array.from(musicSelect.options).forEach(opt => {
        if (opt.value.startsWith('custom_')) {
          opt.remove();
        }
      });
      
      // Add custom tracks to selector
      customMusic.forEach(function(track, index) {
        const option = document.createElement('option');
        option.value = 'custom_' + index;
        option.textContent = track.name + ' (custom)';
        musicSelect.appendChild(option);
      });
      
      // Show/hide custom music list
      if (customMusic.length > 0) {
        customMusicList.style.display = 'block';
        renderCustomTracks(customMusic);
      } else {
        customMusicList.style.display = 'none';
      }
    } catch(e) {
      console.error('Error loading custom music:', e);
    }
  }
  
  // Render custom tracks list with delete buttons
  function renderCustomTracks(tracks) {
    customTracksList.innerHTML = '';
    tracks.forEach(function(track, index) {
      const trackDiv = document.createElement('div');
      trackDiv.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 6px 8px; margin-bottom: 4px; background: var(--overlay-bg); border: 1px solid var(--border-color); border-radius: 2px;';
      
      const name = document.createElement('span');
      name.textContent = track.name;
      name.style.fontSize = '0.85em';
      
      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'delete';
      deleteBtn.className = 'small';
      deleteBtn.style.padding = '2px 8px';
      deleteBtn.onclick = function() { deleteCustomTrack(index); };
      
      trackDiv.appendChild(name);
      trackDiv.appendChild(deleteBtn);
      customTracksList.appendChild(trackDiv);
    });
  }
  
  // Delete custom track
  function deleteCustomTrack(index) {
    try {
      const customMusic = JSON.parse(localStorage.getItem('customMusic') || '[]');
      const deletedTrackId = 'custom_' + index;
      customMusic.splice(index, 1);
      localStorage.setItem('customMusic', JSON.stringify(customMusic));
      loadCustomMusic();
      
      // If deleted track was playing, switch to default
      if (musicSelect.value === deletedTrackId) {
        musicSelect.value = 'default';
        if (typeof applySettings === 'function') {
          applySettings(getCurrentSettings());
        }
      }
    } catch(e) {
      console.error('Error deleting track:', e);
    }
  }
  
  // Play custom audio using Web Audio API
  window.playCustomAudio = function(base64Data, volume, loop) {
    return new Promise(function(resolve, reject) {
      try {
        // Stop current custom audio
        if (window.customAudioSource) {
          window.customAudioSource.stop();
          window.customAudioSource = null;
        }
        
        // Create audio context if needed
        if (!window.audioContext) {
          window.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
        
        // Decode base64 to array buffer
        const base64String = base64Data.split(',')[1];
        const binaryString = atob(base64String);
        const len = binaryString.length;
        const bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
          bytes[i] = binaryString.charCodeAt(i);
        }
        
        // Decode audio data
        window.audioContext.decodeAudioData(bytes.buffer, function(buffer) {
          window.customAudioBuffer = buffer;
          
          // Create source
          const source = window.audioContext.createBufferSource();
          source.buffer = buffer;
          source.loop = loop;
          
          // Create gain node for volume control
          if (!window.customAudioGain) {
            window.customAudioGain = window.audioContext.createGain();
            window.customAudioGain.connect(window.audioContext.destination);
          }
          window.customAudioGain.gain.value = volume;
          
          // Connect and play
          source.connect(window.customAudioGain);
          source.start(0);
          
          window.customAudioSource = source;
          resolve();
        }, function(error) {
          console.error('Error decoding audio:', error);
          reject(error);
        });
      } catch(e) {
        console.error('Error playing custom audio:', e);
        reject(e);
      }
    });
  };
  
  // Stop custom audio
  window.stopCustomAudio = function() {
    if (window.customAudioSource) {
      try {
        window.customAudioSource.stop();
      } catch(e) {}
      window.customAudioSource = null;
    }
  };
  
  // Set custom audio volume
  window.setCustomAudioVolume = function(volume) {
    if (window.customAudioGain) {
      window.customAudioGain.gain.value = volume;
    }
  };
  
  // Handle file upload
  if (customMusicUpload) {
    customMusicUpload.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      // Check file size (10MB limit)
      if (file.size > 10 * 1024 * 1024) {
        alert('File too large! Max 10MB');
        customMusicUpload.value = '';
        return;
      }
      
      // Check if audio file
      if (!file.type.startsWith('audio/')) {
        alert('Please upload an audio file');
        customMusicUpload.value = '';
        return;
      }
      
      try {
        // Convert to base64
        const reader = new FileReader();
        reader.onload = function(event) {
          try {
            const base64 = event.target.result;
            const customMusic = JSON.parse(localStorage.getItem('customMusic') || '[]');
            
            // Add new track
            customMusic.push({
              name: file.name.replace(/\.[^/.]+$/, ''),
              data: base64
            });
            
            localStorage.setItem('customMusic', JSON.stringify(customMusic));
            loadCustomMusic();
            customMusicUpload.value = '';
            
            alert('Track uploaded successfully!');
          } catch(e) {
            if (e.name === 'QuotaExceededError') {
              alert('Storage full! Delete some custom tracks first.');
            } else {
              alert('Error saving track: ' + e.message);
            }
            customMusicUpload.value = '';
          }
        };
        
        reader.onerror = function() {
          alert('Error reading file');
          customMusicUpload.value = '';
        };
        
        reader.readAsDataURL(file);
      } catch(e) {
        alert('Error uploading file: ' + e.message);
        customMusicUpload.value = '';
      }
    });
  }
  
  // Load on page load
  loadCustomMusic();
})();
   </script>
   <script>
    (function() {
  const SAVE_KEYS = [
    'rarityInventory', 'totalRolls', 'achievementsUnlocked',
    'anomalies', 'anomaliesUsed', 'shopPoints', 'shopUpgrades',
    'soldOutRarities', 'playerPotions', 'activePotions',
    'wishingWell', 'luckBoostState', 'totalPlaytime',
    'daily_lastClaim', 'daily_streak', 'weekly_lastClaim', 'weekly_streak'
  ];

  function hash(str) {
    let h = 0;
    for (let i = 0; i < str.length; i++) {
      h = ((h << 5) - h) + str.charCodeAt(i);
      h |= 0;
    }
    return (h >>> 0).toString(16).padStart(8, '0');
  }

  function bundleKeys(keys) {
    const obj = {};
    keys.forEach(k => {
      const v = localStorage.getItem(k);
      if (v !== null) obj[k] = v;
    });
    return obj;
  }

  function encode(bundle, tag) {
    const payload = JSON.stringify(bundle);
    const envelope = JSON.stringify({ p: payload, h: hash(payload), t: tag });
    return btoa(unescape(encodeURIComponent(envelope)));
  }

  function decode(input, expectedTag) {
    let envelope;
    try {
      envelope = JSON.parse(decodeURIComponent(escape(atob(input.trim()))));
    } catch(e) { return { error: 'invalid or corrupted data' }; }
    if (!envelope || !envelope.p || !envelope.h || !envelope.t)
      return { error: 'invalid format' };
    if (envelope.t !== expectedTag)
      return { error: 'wrong type â expected ' + expectedTag };
    if (hash(envelope.p) !== envelope.h)
      return { error: 'tampered or corrupted â blocked' };
    let bundle;
    try { bundle = JSON.parse(envelope.p); } catch(e) {
      return { error: 'payload not valid json' };
    }
    return { bundle: bundle };
  }

  function refreshSave() {
    const bundle = bundleKeys(SAVE_KEYS);
    const codeEl = document.getElementById('saveTransferCode');
    codeEl.textContent = Object.keys(bundle).length > 0 ? encode(bundle, 'save') : '(no save data)';
    adjustPageHeight(codeEl);
  }

  function refreshSettings() {
    const raw = localStorage.getItem('userSettings');
    const codeEl = document.getElementById('settingsTransferCode');
    codeEl.textContent = raw ? encode({ userSettings: raw }, 'settings') : '(no settings)';
    adjustPageHeight(codeEl);
  }

  function copyToClipboard(text, label) {
    navigator.clipboard.writeText(text).then(() => alert(label + ' copied!'))
      .catch(() => {
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position = 'fixed';
        ta.style.opacity = '0';
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        alert(label + ' copied!');
      });
  }

  function downloadAsFile(text, filename) {
    const blob = new Blob([text], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  const saveBtnActions = [
    ['exportSaveBtn', copyToClipboard, 'save data', refreshSave],
    ['downloadSaveBtn', downloadAsFile, 'authsrng_save.txt', refreshSave],
    ['refreshSaveBtn', refreshSave, null, null]
  ];

  const settingsBtnActions = [
    ['exportSettingsBtn', copyToClipboard, 'settings', refreshSettings],
    ['downloadSettingsBtn', downloadAsFile, 'authsrng_settings.txt', refreshSettings],
    ['refreshSettingsBtn', refreshSettings, null, null]
  ];

  function setupBtnActions(actions, type) {
    actions.forEach(([id, func, param, refreshFunc]) => {
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener('click', () => {
        if (type === 'save' || type === 'settings') refreshFunc?.();
        const codeEl = type === 'save' ? document.getElementById('saveTransferCode') : document.getElementById('settingsTransferCode');
        const text = codeEl.textContent;
        if (text.includes('(no ')) { alert('no ' + type + ' data to export'); return; }
        if (func === copyToClipboard) func(text, param);
        else if (func === downloadAsFile) func(text, param);
      });
    });
  }

  setupBtnActions(saveBtnActions, 'save');
  setupBtnActions(settingsBtnActions, 'settings');

  document.getElementById('importSaveBtn').addEventListener('click', () => {
    const input = prompt('paste your save data export:');
    if (!input?.trim()) return;
    const result = decode(input, 'save');
    if (result.error) { alert(result.error); return; }
    Object.keys(result.bundle).forEach(k => localStorage.setItem(k, result.bundle[k]));
    alert('save data imported! reloading...');
    setTimeout(() => location.reload(), 500);
  });

  document.getElementById('importSettingsBtn').addEventListener('click', () => {
    const input = prompt('paste your settings export:');
    if (!input?.trim()) return;
    const result = decode(input, 'settings');
    if (result.error) { alert(result.error); return; }
    if (result.bundle.userSettings) localStorage.setItem('userSettings', result.bundle.userSettings);
    if (typeof applySettings === 'function') {
      try { applySettings(JSON.parse(result.bundle.userSettings)); } catch(e) {}
    }
    alert('settings imported! reloading...');
    setTimeout(() => location.reload(), 500);
  });

  function setupShowMore(codeElId, btnElId) {
    const codeEl = document.getElementById(codeElId);
    const btn = document.getElementById(btnElId);
    let expanded = false;

    function checkOverflow() {
      btn.style.display = codeEl.scrollHeight > codeEl.clientHeight ? 'inline-block' : 'none';
      adjustPageHeight(codeEl);
    }

    btn.addEventListener('click', () => {
      expanded = !expanded;
      codeEl.style.maxHeight = expanded ? 'none' : '3.5em';
      btn.textContent = expanded ? 'show less' : 'show more';
      checkOverflow();
    });

    return checkOverflow;
  }

  function adjustPageHeight(el) {
    const page = el.closest('.page');
    const container = el.closest('.page-container');
    if (page && container) {
      container.style.height = page.scrollHeight + 'px';
    }
  }

  const checkSettingsOverflow = setupShowMore('settingsTransferCode', 'showMoreSettingsBtn');
  const checkSaveOverflow = setupShowMore('saveTransferCode', 'showMoreSaveBtn');

  const _origRefreshSettings = refreshSettings;
  refreshSettings = () => { _origRefreshSettings(); checkSettingsOverflow(); };

  const _origRefreshSave = refreshSave;
  refreshSave = () => { _origRefreshSave(); checkSaveOverflow(); };

  refreshSave();
  refreshSettings();

  document.querySelectorAll('.page-container').forEach(pc => {
    const firstPage = pc.querySelector('.page');
    if (firstPage) pc.style.height = firstPage.scrollHeight + 'px';
  });

})();
   </script>
  </div>
  <button id="autoRollBtn">
   auto roll (OFF)
  </button>
  <button id="devOverlayToggle" style="display: none;">
   hide dev
  </button>
  <div class="entry-container">
   <div class="center-line">
   </div>
   <div class="tap-text">
    click/tap to wake up
   </div>
  </div>
 </body>
</html>
